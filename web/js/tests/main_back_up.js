//////// Events ////////
function addEvents() {
   document.addEventListener( 'keydown', function(event) {
      switch( event.keyCode ) {
         case  38 : pressed_up(); break;
         case  37 : pressed_left(); break;
         case  39 : pressed_right(); break;
         case  40 : pressed_down(); break;
       }
   });
}

function pressed_right () {
}
function pressed_left() {
}
function pressed_up() {
}
function pressed_down() {
}
/////// Print userspace /////////////

function pageHeader( user ) {
  var html = document.getElementById("header");
  var str = html.innerHTML;
  var userName = getRandomName( );
  var userHP   = getUserHP( user );
  var newHTML  = str.replace(/@/, userName );

  newHTML  = newHTML.replace(/\+/, function(match){ 
                     var hp= "#"; 
                     for(i=0;i<userHP-1;i++){
                        hp += "#";      
                     }
                     return hp;
                  });
  html.innerHTML = newHTML;
}
function getRandomName( ) {
   return "Asgaroth";
}
function getUserHP( user ) {
   return user.health;
}

/*
 * Codes :
 *    0 -- empty cell -- 
 *                      " ";
 *    1 -- right cell; -- 
 *                      " #"
 *    2 -- bottom cell; --
 *                       " "
 *                       "#"
 *    3 -- both;
 *                       " #"
 *                       "##"
 *    4 -- heal-items;
 *                       "!"
 *    5 -- trap-items;
 *                       "."
 *    6 -- other-users;
 *                       "W"
 *    7 -- main-user;
 *                       "@"            
 */

function pageBody( map, items ) {
  /*
1. Chech size. 
2. Replace all this shit. But first we try to print the map; 
  */
  var string = map.area.toString().replace(/,/g,"");
  console.log(string);
}

function init_frames( ) {
   var map  = getMap();
   var items = getItems();
   var user = items.user;
   console.log( map );
   console.log( user );
   pageHeader( user );
   pageBody( map, items );
   addEvents();
}

function getItems() {
   var items = "{\"user\":{\"ID\":6666,\"health\":40,\"pos\":234},\"items\":{\"traps\":{\"pos\":[275,959,1175,551,962,1250,218,381,130,890,47,1571,1428,1328,78,870,1140,632,1412,1392,162,1491,510,879,1488,737,56,768,619,280,598,1257]},\"heal\":{\"pos\":[215,882,818,521,1083,190,17,475,177,899,1233,16,1313,552,150,1261,695,1536,544,1021,221,829,1513,1516,1143,490,1146,30,583,897,915,1382,624,1188,1311,1031,1435,250,839,842]},\"other\":{\"ID\":6667,\"pos\":40,\"health\":343}}}";
   return JSON.parse( items );
}
function getMap() {
 var map = "{\"parametrs\":{\"width\":\"40\",\"height\":\"40\"},\"area\": [0,3,0,3,0,2,0,0,0,1,1,1,2,1,2,1,1,1,1,0,2,2,3,1,0,1,0,3,0,3,0,0,3,2,2,0,2,0,3,1,2,1,2,1,0,3,3,3,3,1, 0,1,2,1,0,2,2,2,1,1,0,2,0,2,1,2,0,0,0,1,1,0,2,3,1,2,3,2,2,1,1,1,2,0,3,1,2,2,2,3,1,0,3,0,1,1,0,1,1,2,1,1,3,1,2,1,3,1,3,3,3,0,2,1,0,3,0,1,1,1,0,2,3,0,3,1 ,0,0,3,0,1,3,1,1,3,0,3,0,1,0,2,2,1,1,1,2,3,3,2,0,2,3,1,3,2,1,1,0,1,1,0,1,2,1,0,0,3,1,2,1,0,2,2,2,1,0,3,3,0,2,2,1,0,1,2,0,3,0,3,1,1,1,1,2,1,0,1,3,0,3 ,1,3,0,2,3,3,0,0,3,1,0,3,0,3,1,0,0,3,2,2,1,1,3,0,0,1,1,0,3,2,2,1,2,1,1,1,3,0,2,3,1,0,0,3,0,0,1,1,1,3,1,1,0,3,1,1,3,0,1,1,1,1,2,3,1,2,2,1,1,1,1,1,2,2,1,3,1,1,1,1,1,3,3,1,1,3,1,0,1,1,2,1,1,0,1,0,0,3,2,3,3,0,1,1,2,2,3,0,0,0,1,1,1,1,1,0,1,0,2,1,1,2,1,1,2,3,1,1,2,2,2,2,1,3,1,3,0,0,2,0,1,3,2,2,0,1,2,3,3,1,3,0,0,2,2,1,2,3,2,3,2,0,2,0,0,3,3,0,3,2,1,0,0,3,3,2,1,3,1,3,0,0,0,3,1,0,2,2,1,2,2,1,0,3,1,3,1,1,0,1,1,2,1,3,1,1,2,3,1,0,3,3,3,1,2,0,0,2,3,0,1,3,3,0,3,0,2,3,3,0,2,1,1,1,1,1,1,2,3,1,1,1,0,3,1,2,1,0,1,2,1,0,3,1,2,3,2,1,0,3,3,1,1,2,1,0,0,3,0,1,1,3,3,2,1,1,0,3,1,1,0,0,1,1,1,1,0,1,1,2,2,1,0,3,1,2,1,1,2,3,0,0,1,2,1,1,2,3,3,0,3,1,1,1,1,0,0,0,2,1,3,3,1,1,3,1,1,3,0,1,1,1,1,1,2,2,1,3,1,1,3,3,1,1,3,0,0,3,1,2,0,1,0,0,3,3,1,1,2,3,1,2,1,1,2,1,0,3,1,2,3,0,3,1,2,1,1,1,1,1,2,1,0,1,1,3,2,1,2,1,3,2,3,1,1,0,1,2,0,3,1,2,2,1,1,2,0,1,3,1,1,1,0,3,0,0,2,0,1,0,1,1,1,1,2,0,0,1,2,0,3,1,1,0,1,3,1,2,2,1,0,3,1,1,0,2,1,0,0,1,1,2,2,1,1,0,3,1,1,1,0,3,1,3,1,3,1,0,3,0,0,0,2,1,0,2,1,2,2,1,2,2,1,1,2,1,3,1,3,1,1,1,1,1,1,2,1,3,0,3,3,1,2,2,1,1,3,0,3,3,1,1,2,1,1,0,2,2,3,1,1,2,0,3,1,0,3,3,1,2,2,2,2,0,1,2,1,1,2,1,1,2,1,0,3,1,0,0,3,1,1,3,1,1,1,1,1,2,1,3,2,1,0,1,0,0,2,2,2,2,3,1,0,3,2,3,0,3,2,1,1,1,2,2,2,2,3,3,2,0,1,1,0,1,3,2,1,1,1,1,2,1,1,3,3,1,1,2,1,1,2,1,0,0,2,1,1,2,0,2,1,1,0,0,1,1,0,0,2,1,1,2,1,0,0,1,0,1,0,1,1,2,0,1,1,1,0,0,3,0,1,0,1,3,1,3,2,1,1,0,2,2,1,1,0,3,1,0,1,3,3,1,3,1,3,1,3,2,1,1,0,1,1,2,1,0,3,1,1,1,1,1,1,1,1,0,3,1,3,0,3,1,1,3,2,0,3,1,0,1,0,0,0,2,3,3,1,1,1,3,3,1,2,3,0,2,1,2,0,3,3,3,2,3,0,2,2,1,2,2,1,2,1,1,1,0,3,1,3,3,1,1,0,3,0,2,1,1,1,1,1,2,2,0,1,0,1,2,2,1,1,2,0,1,0,3,1,1,1,0,1,0,1,0,2,3,0,0,0,1,1,3,2,3,2,3,1,2,3,1,1,0,1,3,3,3,1,2,2,1,1,2,1,0,2,0,1,2,1,1,1,3,3,1,0,1,1,1,3,3,0,3,2,2,1,2,0,3,1,1,1,3,1,1,1,0,1,2,1,1,1,0,1,3,0,3,1,0,3,1,0,0,3,3,1,2,3,3,1,1,0,3,0,3,1,1,0,1,1,1,2,2,0,2,1,1,3,2,2,2,3,1,2,1,2,3,3,3,0,3,3,0,2,3,0,0,2,3,2,1,0,0,2,3,1,1,1,1,2,1,0,3,0,3,3,0,3,2,2,2,1,1,1,3,2,0,3,2,2,3,1,2,1,2,3,2,0,2,2,3,3,3,2,0,2,0,1,2,2,1,0,2,2,0,3,0,1,1,2,1,1,1,2,1,0,2,3,1,1,1,0,1,1,1,1,2,3,1,1,1,2,1,1,0,1,1,0,1,1,3,2,1,1,3,2,3,3,1,1,1,1,2,2,3,2,1,1,1,2,1,3,1,1,1,1,0,3,0,2,3,1,0,0,3,1,3,3,3,1,1,2,1,1,1,1,0,3,1,1,1,0,3,0,3,1,1,2,1,1,1,0,2,2,1,0,0,1,1,2,0,0,3,0,1,2,1,1,0,3,1,1,1,1,0,1,0,3,0,3,1,1,2,0,1,0,0,0,2,3,0,2,2,3,3,3,3,0,3,0,1,3,0,1,3,0,1,1,0,0,1,1,0,3,3,2,1,1,0,0,2,0,3,1,3,1,3,1,2,1,1,0,3,1,1,1,2,2,1,3,3,0,3,2,3,1,3,1,3,3,1,0,1,0,2,0,0,3,1,0,1,3,1,0,2,1,2,1,1,1,1,2,1,1,2,1,1,1,2,1,0,3,2,0,2,2,0,3,2,0,3,3,2,0,1,3,1,2,1,1,1,0,3,1,0,0,3,3,0,2,1,1,1,2,0,2,1,1,2,1,2,1,1,3,1,1,2,3,1,0,3,0,3,1,3,0,2,0,3,3,2,0,2,3,1,1,0,0,1,1,1,1,1,2,1,1,1,1,1,0,1,2,2,1,1,1,1,0,2,0,3,2,0,1,1,1,0,2,0,0,3,2,1,0,3,0,1,3,0,1,1,2,1,1,3,2,1,2,2,1,2,0,3,1,1,1,1,0,1,3,1,1,3,1,1,3,3,0,3,3,1,1,3,0,3,1,2,3,3,3,3,1,2,1,0,2,3,2,1,1,0,3,1,1,1,1,0,1,2,1,1,2,2,2,2,2,3,2,2,2,2,3,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,3,2,3,2,3]}";   

   return JSON.parse(map);
}
